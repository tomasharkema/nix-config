{
  pkgs,
  lib,
  config,
  ...
}: {
  config = {
    environment.systemPackages =
      (with pkgs; [
        (lib.mkIf pkgs.stdenv.isx86_64 ipmicfg)
        libsecret
        # apfs-fuse
        # apfsprogs
        # bat-extras.batgrep
        ssh-tools
        cutecom
        dry
        gpio-utils
        isd
        # jupyter
        ldapdomaindump
        # lz4
        # mkchromecast
        # nix-switcher # : needs github auth
        ntfy
        oterm
        pamix
        socklog
        systeroid
        tailspin
        agenix-rekey
        apt-dater
        pwgen
        aide
        archivemount
        bandwhich
        bash
        bashmount
        bat-extras.batdiff
        bat-extras.batman
        bat-extras.batpipe
        bat-extras.batwatch
        binwalk
        bmc-tools
        bmon
        bridge-utils
        caligula
        castnow
        catt
        ccrypt
        chunkfs
        cksfv
        clang-tools
        clex
        cmake
        colorized-logs
        compsize
        config.boot.kernelPackages.iio-utils
        cryptsetup # needed for dm-crypt volumes
        ctop
        curl
        custom.discovery-rs
        custom.partclone-utils
        custom.meshtui
        custom.wikiman
        custom.zide
        libusb1
        ddrescue
        devcontainer
        devtodo
        dfrs
        distrobox
        distrobox-tui
        duc
        efibootmgr
        efivar
        esp-idf-full
        ethtool
        # fancy-motd
        fcast-receiver
        freeipmi
        fuse
        fuse3
        gdb
        gdbgui
        gdu
        gensio
        ghostty
        git
        git
        glog
        glogg
        gnumake
        gnupg
        gpsd
        gptfdisk
        hdparm
        helix
        hextazy
        htmlq
        hueadm
        hw-probe
        i2c-tools
        ifuse
        imv
        ipcalc
        ipmitool
        ipmiutil
        iptraf-ng
        kexec-tools
        kmon
        lazydocker
        libftdi
        libftdi1
        libgpiod
        libheif
        libnotify
        lm_sensors
        lnav
        lorri
        lrzsz
        lshw
        mbuffer
        minio-client
        mpremote
        mpv
        ms-sys # for writing Microsoft boot sectors / MBRs
        ncdu
        nethogs
        netop
        netproc
        netscanner
        networkmanagerapplet
        nfs-utils
        nil
        ninja
        nix-btm
        nix-check-deps
        nix-playground
        nix-search-cli
        nix-search-tv
        nix-top
        nixd
        nixos-facter

        nmap
        nmon
        ntfs3g
        ntfy-sh
        nvchecker
        nvme-cli
        nyaa
        onionshare
        openipmi
        openldap
        openocd
        openseachest
        opensoundmeter
        p7zip
        pamixer
        parted
        pciutils
        pciutils
        picotool
        picotool
        pigz
        piratebay
        pkgs.custom.nix-helpers
        play
        ponymix
        pulsemixer
        pv
        python313Packages.pyftdi
        python3Packages.pip
        python3Packages.uv
        redfishtool
        regname
        rsbkb
        rtop
        s-tui
        screen
        sdparm
        ser2net
        sigrok-cli
        silenthound
        smartmontools
        socat
        squashfs-tools-ng
        squashfsTools
        ssh-import-id
        ssh-tools
        sshfs
        sshfs-fuse
        sshportal
        starship
        strace
        swapview
        sysstat
        systemctl-tui
        sysz
        tcpdump
        tcptrack
        termshark
        testdisk # useful for repairing boot problems
        tio
        tiptop
        tparted
        tpm-tools
        tran
        treecat
        tshark
        tsui
        ttmkfdir
        ttop
        tydra
        unzip
        update-nix-fetchgit
        updatecli
        urjtag
        usbredir
        usbutils
        usbutils
        usermount
        uv
        viddy
        vim
        watchlog
        # wavemon
        websocat
        wget
        wget
        whatfiles
        wmctrl
        wol
        wtfutil
        xterm
        xxd
        zathura
        zip
        zstd
      ])
      ++ (with pkgs.custom; [
        ssh-proxy-agent
        menu
        pvzstd
        ssm
        tailscale-tui
        sshed
        # rmfuse
      ])
      ++ (lib.optionals pkgs.stdenv.isx86_64 (
        with pkgs; [
          meshtastic-fix
          spectre-meltdown-checker
          gnutls
          cmospwd
          uefisettings
          libsmbios
          micropython
          dmidecode
          refind
          fwupd
          fwupd-efi
        ]
      ));
  };
}
